{% set title = "상점 화면" %}
{% extends "layout/client.html" %}
{% block content %}

<!-- {{ shop | dump}} -->

<!-- todo: slick.js로 carousel 입히기-->
<!-- restaurant detail -->
<main class="container detail">
 <section class="row img-slider" 
    {% if not shop.thumbnail %}
        style="background-image: url(/static/images/thumb.jpg);"
    {% else %}
        style="background-image: url(/uploads/{{ shop.thumbnail}});"
    {% endif %}
        >
   <div class="col-xs-12">
     <h2 class="a11y-hidden">이미지 슬라이더</h2>
     <button type="button" class="btn-prev">
       <i class="fa fa-angle-left" aria-hidden="true"></i>
       <span class="a11y-hidden">이전</span>
     </button>
     <button type="button" class="btn-next">
       <i class="fa fa-angle-right" aria-hidden="true"></i>
       <span class="a11y-hidden">다음</span>
     </button>
     <ul class="indicator">
       <li class="active"><a href="">1번째</a></li>
       <li><a href="">2번째</a></li>
       <li><a href="">3번째</a></li>
       <li><a href="">4번째</a></li>
       <li><a href="">5번째</a></li>
     </ul>
   </div>
 </section>
 <section class="row restaurant-info">
   <div class="col-xs-12 name">
     <h2 class="h6"> {{shop.name}} </h2>
     <button type="button" class="btn btn-link btn-ghost btn-share">
       <i class="fa fa-share-alt" aria-hidden="true"></i>
       <span class="a11y-hidden">공유하기</span>
   </button>
   </div>
   <ul class="col-xs-12 info1 body1">
     <li>{{sho.address}}</li>
     <li>{{shop.phone}}</li>
     <li>
       <button type="button" class="btn btn-link btn-like">
         <i class="fa fa-heart" aria-hidden="true"></i>
         <span>10</span>
       </button>
     </li>
   </ul>
 </section>
 <section class="row menu-board">
   <div class="col-xs-12">
     <div class="menu-box">
       <h2 class="sub-title1 font-nanum title">대표 메뉴</h2>
       <ul class="menu-list">

       {% for menu in shop.Menu%}
         <li><a href="#"
         menu_id="{{menu.id}}"
         name="{{menu.name}}"
         price = "{{menu.price}}"
         class="getCart"
         >
           <h3 class="sub-title2">{{menu.name}}</h3>
           <p class="body2">{{menu.price}}원</p>
         </a></li>
        {% else %}
         <li><a href="">
           <h3 class="sub-title2">메뉴가 없습니다.</h3>
         </a></li>
        {% endfor %}
       </ul>
     </div>
   </div>
 </section>
 <section class="row restaurant-info2 body2">
   <ul class="col-xs-12">
     <li>
       <i class="fa fa-check" aria-hidden="true"></i>
       <span class="textPrimary">위치</span>
       <span>서울시 강남구</span>
     </li>
     <li>
       <i class="fa fa-check" aria-hidden="true"></i>
       <span class="textPrimary">운영시간</span>
       <span>8시 ~ 20시</span>
     </li>
     <li>
       <i class="fa fa-check" aria-hidden="true"></i>
       <span class="textPrimary">연락처</span>
       <span>010-1234-5678</span>
     </li>
   </ul>
 </section>
 <section class="row restaurant-map">
   <div class="col-xs-12">
     <div class="map-area">
       <div class="pointer">음식점 위치</div>
       <div class="user-pointer">
         <i class="fa fa-user" aria-hidden="true"></i>
         <span class="a11y-hidden">내 위치</span>
       </div>
     </div>
   </div>
 </section>
</main>
<!-- cart -->
<a class="btn-cart" >
 <i class="fa fa-shopping-cart" aria-hidden="true"></i>
 <i class="cart-item-counter">{{cartLength}}</i>
</a>
<script>
$(document).ready(function(){
  {% if not sameShops %}
    alert('Only the items from the same store can be stored.');
  {% endif %}

 $('.btn-cart').click(function(){
    var cartCounter = parseInt ( $('.cart-item-counter').text() );

    if(!cartCounter){
      alert('There is nothing in the cart')
    }else{
      location.href="/cart";
    }
  });
 $('.getCart').click(function(e){

   //링크 이동 방지
   e.preventDefault();

   if(confirm('Move to Cart?')){
//cartList[1], cartList[2] 에 있는 상품들을 담는다
// cartList[i] = { menu: xxx, price: xxx}, etc
      //장바구니에 담을 메뉴 ID, 이름, 가격을 받는다
       var shop_id = {{ shop.id }};
       var menu_id = $(this).attr('menu_id');
       var name = $(this).attr('name');
       var price = $(this).attr('price');
       var cartList = {};

       if( getCookie('cartList') ){
           //쿠키에서 검색후 있으면 json 파싱함
           cartList = JSON.parse(getCookie('cartList'));
       }
      
       cartList[menu_id] = {
         shop_id,
         menu_id,
         name,
         price
       };

       // string으로 저장되는데 나중에 {}형식으로 받기위해 stringfy로 저장
       //setCookie 는 string으로 저장됨.
       setCookieHour( "cartList" , JSON.stringify(cartList) , 3 );
        //update cartList counter
       $('.cart-item-counter').text( Object.keys(cartList).length );
       alert("Item Moved to the Cart.");


   }
 });  
});
</script>

{% endblock %}
